# Particle Life - WebGPU Implementation

## Overview

This project now includes **two implementations** of Particle Life:

1. **Zig + WASM + Canvas 2D** (`web/particle-life.html`) - CPU simulation in Zig compiled to WASM, rendered with Canvas 2D
2. **Pure WebGPU** (`web/particle-life-webgpu.html`) - GPU compute shaders for simulation, GPU rendering with WGSL shaders

## ðŸš€ WebGPU Version Features

The WebGPU implementation is a **faithful port of the [Nikita Lisyarus demo](https://lisyarus.github.io/blog/programming/2023/02/21/particle-life.html)** with all the same features:

### GPU Compute Pipeline
- **Spatial binning** with atomic operations for efficient neighbor search
- **Prefix sum** for parallel particle sorting
- **Force computation** with attraction/repulsion between species
- **Particle advancement** with boundary handling (bounce or loop)

### GPU Rendering
- **HDR rendering** with floating-point textures
- **Glow effects** with exponential falloff
- **Smooth particle rendering** with antialiasing
- **Point rendering** for zoomed-out views
- **ACE tonemapping** with dithering for better color quality

### UI Controls
- Adjustable particle count (1024 - 1M particles)
- Adjustable species count (1-20 types)
- Configurable simulation size
- Friction and central force controls
- Symmetric forces option
- Looping vs bouncing borders

### Interaction
- **Left mouse drag**: Push particles with force field
- **Right mouse drag**: Pan camera
- **Mouse wheel**: Zoom in/out
- **Space**: Pause/Resume
- **C**: Center view
- **S**: Toggle control panel
- **D**: Toggle debug panel

## Performance Comparison

| Feature | Zig + Canvas 2D | WebGPU |
|---------|----------------|--------|
| Simulation | CPU (WASM) | GPU (Compute Shaders) |
| Rendering | Canvas 2D | WebGPU (WGSL Shaders) |
| Max Particles | ~16K @ 60fps | ~1M @ 60fps |
| Spatial Binning | CPU | GPU (Atomic Ops) |
| Visual Quality | Good | Excellent (HDR + Glow) |

## Browser Requirements

### WebGPU Version
- **Chrome/Edge 113+** with WebGPU enabled
- **Firefox Nightly** with `dom.webgpu.enabled` flag
- **Safari Technology Preview** on macOS

### Zig + WASM Version
- Any modern browser with WebAssembly support

## File Structure

```
web/
â”œâ”€â”€ particle-life.html            # Zig + WASM + Canvas 2D version
â”œâ”€â”€ particle-life-webgpu.html     # Pure WebGPU version
â”œâ”€â”€ particle-life.js              # Generated by Emscripten
â”œâ”€â”€ particle-life.wasm            # Compiled Zig code
â”œâ”€â”€ blue-noise.png                # Dithering texture for WebGPU
â”œâ”€â”€ favicon.ico
â””â”€â”€ shell.html                    # Emscripten HTML template
```

## Running the WebGPU Version

1. **Open `web/particle-life-webgpu.html` in a WebGPU-compatible browser**
   
   Or serve it with a local server:
   ```bash
   # Python
   python -m http.server 8000
   
   # Node.js
   npx http-server web -p 8000
   ```

2. **Navigate to**: `http://localhost:8000/particle-life-webgpu.html`

3. **Enjoy!** The simulation should start immediately with 16K particles and 6 species.

## Key Differences from Nikita's Demo

1. **No WASM dependency**: Pure JavaScript + WebGPU (no Zig WASM needed for this version)
2. **Simplified UI**: Cleaner control panel with essential parameters
3. **Same performance**: Identical GPU compute pipeline and rendering
4. **Cross-platform**: Works on Windows, macOS, Linux with WebGPU support

## Shaders (WGSL)

All shaders from the Nikita demo are included:

### Compute Shaders
- **binFillSizeShader**: Count particles per spatial bin
- **binPrefixSumShader**: Parallel prefix sum for sorting
- **particleSortShader**: Sort particles into bins
- **particleComputeForcesShader**: Calculate inter-particle forces
- **particleAdvanceShader**: Update particle positions/velocities

### Render Shaders
- **particleRenderShader**: Vertex + fragment shaders for particles
  - `vertexGlow` / `fragmentGlow`: Soft glow effect
  - `vertexCircle` / `fragmentCircle`: Antialiased circles
  - `vertexPoint` / `fragmentPoint`: Point rendering for zoomed-out view
- **composeShader**: HDR â†’ LDR with tonemapping and dithering

## Technical Details

### Spatial Binning
Uses a **uniform grid** with bins of size `maxForceRadius` (32 units). Each particle checks its 9 neighboring bins (3x3 grid) for interactions.

### Force Calculation
Each species pair has 4 parameters:
- **strength**: Attraction (positive) or repulsion (negative)
- **radius**: Maximum interaction distance
- **collisionStrength**: Short-range repulsion to prevent overlap
- **collisionRadius**: Distance for collision force

### Rendering Pipeline
1. Render particles to **HDR texture** (rgba16float)
2. Apply **ACE tonemapping** to convert HDR â†’ LDR
3. Apply **gamma correction** (sRGB)
4. Apply **blue noise dithering** to reduce banding
5. Present to screen

## Credits

- **Original Demo**: [Nikita Lisyarus](https://lisyarus.github.io/blog)
- **Zig Port**: This project
- **WebGPU Implementation**: Direct port from original demo

## License

MIT License - See original demo for full license text.

